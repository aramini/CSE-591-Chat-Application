<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Room 1</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <div class="container">
        <h1>Expert Chat Room</h1>
        <div class="row">
            <div class="col-xs-8">
                <form class="form-horizontal">
                    <h2>Details</h2>
                    <div id="detail" class="well" style="height:50px;"></div>
                    <div id="chat" class="well" style="height:500px; overflow-y:auto;"></div>
                    <input type="text" class="form-control" id="reply-box" placeholder="Enter your text here"></input>
                    <button class="btn btn-default pull-right" type="button" id="send">Send</button>
                </form>
            </div>
            <div class="col-xs-4">
                <ul class="list-group" id="list-teachers">
                </ul>
                <li class="list-group-item active">Participants</li>
                <ul class="list-group" id="list-participants" style="height:200px; overflow-y:scroll;">
                    
                </ul>
                <div class="panel-default">
                    <div class="panel-heading">Summary</div>
                    <div class="panel-body">
                        <div id="summarytext" class="well" style="height:100px; overflow-y:auto;"></div>
                    </div>
                    <div class="btn btn-primary" data-toggle="modal" data-target="#myModal">Edit</div>
                    <div class="modal" id="myModal">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&close;</button>-->
                                    <h4 class="modal-title">Modal title</h4>
                                </div>
                                <div class="modal-body">
                                    <textarea class="form-control" rows="8" id="summary"></textarea>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="save-summary">Save changes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-default">
                        <div class="panel-heading">Files</div>
                        <div class="panel-body" style="height:200px;">
                        </div>
                        <div class="panel-footer">
                            <button class="btn btn-default" id="upload">Upload File</button>
                        </div>
                        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
                        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
                        <!-- Include all compiled plugins (below), or include individual files as needed -->
                        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
                        <script src="/socket.io/socket.io.js"></script>
                        <script>
                        var socket = io.connect('http://localhost:3000');
                        socket.on('connect', function() {
                            // call the server-side function 'adduser' and send one parameter (value of prompt)
                            socket.emit('adduser', prompt("What's your name?"));
                        });
                        socket.on('enteruser', function(username) {
                          console.log("am here");
                            console.log(username);
                            if (username != null) {
                                var l = localStorage.getItem("name");
                                var t = localStorage.getItem("time")
                                $("#detail").html('<b>' + "ExpertName:" + '</b>' + l + '&nbsp;' + '<b>' + "Timings:" + '</b>' + t + '</br>');
                                //$('#list-participants').append('<li class="list-group-item">' + username + '</li>');
                                $( "#list-participants" ).empty();
                                $.each(username, function(key,value){
                                    $('#list-participants').append('<li class="list-group-item">' + key + '</li>');
                                });
                            }
                        });
                        socket.on('deleteuser', function(username) {
                            $('li:contains(' + username + ')').remove();
                        });
                        socket.on('updatechat', function(username, data) {

                            $('#chat').append('<b>' + username + '</b>' + " " + data + "</br>");
                        });
                        socket.on('clearchat', function() {

                            $('#chat').text("");
                        });
                        socket.on('summary', function(data) {

                            $('#summarytext').text(data);
                        });
                        $(function() {
                            $('#send').click(function() {

                                var message = $('#reply-box').val();

                                $('#reply-box').val('');
                                socket.emit('sendchat', message);
                            });
                            $('#reply-box').keypress(function(e) {
                                if (e.keyCode == 13) {
                                    $(this).blur();
                                    $('#send').click();
                                    return false;
                                }
                            });
                            $('#save-summary').click(function() {

                                var editedsummary = $('#summary').val();

                                $('#summarytext').text(editedsummary);
                                socket.emit('savesummary',editedsummary);
                            });

                        });
                        </script>
</body>

</html>
